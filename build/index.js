(()=>{"use strict";var e={874:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}i((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};t.__esModule=!0,t.getLevel=t.addLevel=void 0;var s=r(553),u=r(736);t.addLevel=function(e,t){return n(this,void 0,void 0,(function(){var r,n,u;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=e.body,[4,s.default.create(r)];case 1:return n=a.sent(),t.status(200).json(n),[3,3];case 2:return u=a.sent(),console.error(u),t.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))},t.getLevel=function(e,t){return n(this,void 0,void 0,(function(){var r,n,o,i,c,l,d;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),r=e.params.game,n=Number(e.params.level),r&&n?[4,s.default.findOne({game:r,levelNumber:n})]:[2];case 1:return o=a.sent(),[4,u.default.findOne({_id:e.body.userData.user_id})];case 2:return(i=a.sent())?o?(c=o.description.rulesList.map((function(e){return e[i.language]})),l={winCondition:o.winCondition,name:o.name[i.language],description:{paragraph:o.description.paragraph[i.language],rulesList:c,example:o.description.example[i.language]},submitText:o.submitText[i.language],type1Quantity:o.type1Quantity,type2Quantity:o.type2Quantity,type3Quantity:o.type3Quantity},t.status(200).json(l),[3,4]):[2,t.status(404).send("Level ".concat(n,' of the game "').concat(r,'" not found'))]:[2,t.status(401).send("Invalid Token")];case 3:return d=a.sent(),console.error(d),t.status(500).send("Server error"),[3,4];case 4:return[2]}}))}))}},507:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}i((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};t.__esModule=!0,t.verifyToken=t.checkEmailEligibility=t.checkUsernameEligibility=t.registerUser=t.loginUser=void 0;var s=r(432),u=r(344),o=r(966),i=r(736);t.loginUser=function(e,t){return n(this,void 0,void 0,(function(){var r,n,i,c,l,d,f,p,v,h;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,6,,7]),r=e.body,n=r.login,i=r.password,n&&i?[4,o.default.findOne({email:n})]:[2,t.status(400).send('Invalid input: "password" and "login" are required')];case 1:return(l=a.sent())?[3,3]:[4,o.default.findOne({username:n})];case 2:l=a.sent(),a.label=3;case 3:return d=(c=l).password,(f=c)?[4,s.compare(i,d)]:[3,5];case 4:f=a.sent(),a.label=5;case 5:return f?(p=u.sign({user_id:c._id,isAdmin:c.isAdmin},process.env.TOKEN_KEY,{expiresIn:process.env.TOKEN_LIFETIME}),v={username:c.username,email:c.email,token:p},t.status(200).json(v),[3,7]):(t.status(404).send('User with this "password" and "login" was not found'),[2]);case 6:return h=a.sent(),console.error(h),t.status(500).send("Server error"),[3,7];case 7:return[2]}}))}))};var c=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;t.registerUser=function(e,t){return n(this,void 0,void 0,(function(){var r,n,l,d,f,p,v,h,y,b,m;return a(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,4,,5]),r=e.body,n=r.email,l=r.password,d=r.username,f=r.adminPassword,p=!1,!(n&&l&&d))return[2,t.status(400).send('Invalid input: "email", "password" and "username" are required')];if(!c.test(n))return[2,t.status(400).send("Invalid email")];if(l.length<6)return[2,t.status(400).send("Password must be at least 6 characters long")];if(f){if(f!==process.env.ADMIN_PASSWORD)return[2,t.status(401).send("Invalid admin password")];p=!0}return[4,s.hash(l,10)];case 1:return v=a.sent(),[4,o.default.create({email:n.toLowerCase(),username:d,password:v,isAdmin:p})];case 2:return h=a.sent(),[4,i.default.create({username:d,_id:h._id})];case 3:return a.sent(),y=u.sign({user_id:h._id,isAdmin:p},process.env.TOKEN_KEY,{expiresIn:process.env.TOKEN_LIFETIME}),b={username:d,email:n,token:y},t.status(201).json(b),[3,5];case 4:return m=a.sent(),console.error(m),t.status(500).send("Server error"),[3,5];case 5:return[2]}}))}))},t.checkUsernameEligibility=function(e){var t=this;return function(r,s,u){return n(t,void 0,void 0,(function(){var t,n;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),(t=r.body.username)?[3,1]:[2,s.status(400).send('Invalid input: "username" is required')];case 1:return[4,o.default.findOne({username:t})];case 2:if(a.sent())return[2,s.status(422).send("Username is already taken")];a.label=3;case 3:return e?(s.end(),[3,5]):[2,u()];case 4:return n=a.sent(),console.error(n),s.status(500).send("Server error"),[3,5];case 5:return[2]}}))}))}},t.checkEmailEligibility=function(e){var t=this;return function(r,s,u){return n(t,void 0,void 0,(function(){var t,n;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),(t=r.body.email)?[3,1]:[2,s.status(400).send('Invalid input: "email" is required')];case 1:return[4,o.default.findOne({email:t})];case 2:if(a.sent())return[2,s.status(409).send("A user with this email address already exists")];a.label=3;case 3:return e?(s.end(),[3,5]):[2,u()];case 4:return n=a.sent(),console.error(n),s.status(500).send("Server error"),[3,5];case 5:return[2]}}))}))}},t.verifyToken=function(e,t){var r=this;return function(s,o,i){return n(r,void 0,void 0,(function(){var r,n;return a(this,(function(a){if(!(r=s.body.token||s.query.token||s.headers["x-access-token"]))return[2,o.status(403).send("A token is required for authentication")];try{if(void 0===(n=u.verify(r,process.env.TOKEN_KEY)).user_id||void 0===n.isAdmin)return[2,o.status(401).send("Invalid Token")];if(e&&!n.isAdmin)return[2,o.status(401).send("You don't have rights to do that")];s.body.userData=n}catch(e){return[2,o.status(401).send("Invalid Token")]}return t?[2,o.status(200).end()]:[2,i()]}))}))}}},198:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}i((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};t.__esModule=!0,t.processAvatar=t.getAvatar=t.updateAvatarByUsername=t.updateAvatar=void 0;var s=r(441),u=r(736),o=r(781),i=r(667),c=r(13);t.updateAvatar=function(e,t){return n(this,void 0,void 0,(function(){var r,n,s;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=e.body.avatarId,n=e.body.userData.user_id,[4,u.default.findOneAndUpdate({_id:n},{avatarId:r},{new:!0})];case 1:return a.sent(),t.status(200).end(),[3,3];case 2:return s=a.sent(),console.error(s),t.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))},t.updateAvatarByUsername=function(e,t){return n(this,void 0,void 0,(function(){var r,n,s;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),r=e.body.avatarId,(n=e.params.username)?[4,u.default.findOneAndUpdate({username:n},{avatarId:r},{new:!0})]:[3,2];case 1:return a.sent(),[3,3];case 2:return[2,t.status(400).send('Invalid input: "username" is required')];case 3:return t.status(200).end(),[3,5];case 4:return s=a.sent(),console.error(s),t.status(500).send("Server error"),[3,5];case 5:return[2]}}))}))};var l=new c.ObjectId(process.env.DEFAULT_AVATARID);t.getAvatar=function(e,t){return n(this,void 0,void 0,(function(){var r,n,s,o,c;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),(r=e.params.username)?[4,u.default.findOne({username:r})]:[2,t.status(400).send('Invalid input: "username" is required')];case 1:return(n=a.sent())?n.avatarId?(s=void 0,[4,i.bucket.find({_id:n.avatarId}).toArray()]):(t.setHeader("content-type","image/png"),i.bucket.openDownloadStream(l).pipe(t),[2]):[2,t.status(404).send('User with this "username" not found')];case 2:return o=a.sent(),s=o&&0!==o.length?n.avatarId:l,i.bucket.openDownloadStream(s).pipe(t),[3,4];case 3:return c=a.sent(),console.error(c),t.status(500).send("Server error"),[3,4];case 4:return[2]}}))}))},t.processAvatar=function(e,t,r){return n(this,void 0,void 0,(function(){var n,u;return a(this,(function(a){try{n=e.file,u=n.buffer,s(u).resize(192,192,{fit:"contain",background:"#fff"}).flatten({background:"#fff"}).jpeg({quality:50}).toBuffer((function(t,a){var s=o.Readable.from(a);i.avatarStorage.fromStream(s,e,n).then((function(t){e.body.avatarId=t.id,r()}))}))}catch(e){console.error(e),t.status(500).send("Server error")}return[2]}))}))}},105:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}i((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};t.__esModule=!0,t.getUserDataByUsername=t.getUserData=t.updateUserDataByUsername=t.updateUserData=void 0;var s=r(736);t.updateUserData=function(e,t,r){return n(this,void 0,void 0,(function(){var n,u,o,i,c,l,d,f;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),n=e.body,u=n.language,o=n.levelFlexbox,u||o?(i=void 0,e.body.username?e.body.userData.isAdmin?(c=String(e.body.username),[4,s.default.findOneAndUpdate({username:c},{language:u,levelFlexbox:o},{new:!0})]):[2,t.status(401).send("You don't have rights to do that")]:[3,2]):[2,r()];case 1:return i=a.sent(),[3,4];case 2:return l=e.body.userData.user_id,[4,s.default.findOneAndUpdate({_id:l},{language:u,levelFlexbox:o},{new:!0})];case 3:i=a.sent(),a.label=4;case 4:return d={language:i.language,levelFlexbox:i.levelFlexbox},t.status(200).json(d),[3,6];case 5:return f=a.sent(),console.error(f),t.status(500).send("Server error"),[3,6];case 6:return[2]}}))}))},t.updateUserDataByUsername=function(e,t,r){return n(this,void 0,void 0,(function(){var n,u,o,i,c,l,d;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=e.body,u=n.language,o=n.levelFlexbox,u||o?(i=e.params.username)?[4,s.default.findOneAndUpdate({username:i},{language:u,levelFlexbox:o},{new:!0})]:[2,t.status(400).send('Invalid input: "username" is required')]:[2,r()];case 1:return c=a.sent(),l={language:c.language,levelFlexbox:c.levelFlexbox},t.status(200).json(l),[3,3];case 2:return d=a.sent(),console.error(d),t.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))},t.getUserData=function(e,t){return n(this,void 0,void 0,(function(){var r,n,u,o,i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),r=void 0,e.body.username?e.body.userData.isAdmin?(n=String(e.body.username),[4,s.default.findOne({username:n})]):[2,t.status(401).send("You don't have rights to do that")]:[3,2];case 1:return(r=a.sent())?[3,4]:[2,t.status(404).send('User with this "nickname" not found')];case 2:return u=e.body.userData.user_id,[4,s.default.findOne({_id:u})];case 3:r=a.sent(),a.label=4;case 4:return o={language:r.language,levelFlexbox:r.levelFlexbox},t.status(200).json(o),[3,6];case 5:return i=a.sent(),console.error(i),t.status(500).send("Server error"),[3,6];case 6:return[2]}}))}))},t.getUserDataByUsername=function(e,t){return n(this,void 0,void 0,(function(){var r,n,u,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),(r=e.params.username)?e.body.userData.isAdmin?[4,s.default.findOne({username:r})]:[2,t.status(401).send("You don't have rights to do that")]:[2,t.status(400).send('Invalid input: "username" is required')];case 1:return(n=a.sent())?(u={language:n.language,levelFlexbox:n.levelFlexbox},t.status(200).json(u),[3,3]):[2,t.status(404).send('User with this "nickname" not found')];case 2:return o=a.sent(),console.error(o),t.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))}},776:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}i((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};t.__esModule=!0,t.getUsersRecords=void 0;var s=r(736);t.getUsersRecords=function(e,t){return n(this,void 0,void 0,(function(){var r,n,u,o,i,c,l,d;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),r=e.query,n=s.default.find(),r.limit>=0&&(r.page>=0&&n.skip(r.limit*(r.page-1)),n.limit(r.limit)),n.sort([[r.sort,r.order]]),n.select({_id:0,username:1,levelFlexbox:1}),[4,n.exec()];case 1:return u=a.sent(),i=(o=t).setHeader,c=["X-Total-Count"],l="".concat,[4,s.default.find().estimatedDocumentCount().exec()];case 2:return i.apply(o,c.concat([l.apply("",[a.sent()])])),t.status(200).json(u),[3,4];case 3:return d=a.sent(),console.error(d),t.status(500).send("Server error"),[3,4];case 4:return[2]}}))}))}},607:(e,t,r)=>{t.__esModule=!0,t.listen=t.MONGODB_URI=t.PORT=void 0;var n=r(860);r(142).config();var a=r(470),s=r(582),u=r(14),o=r(667);t.PORT=process.env.PORT,t.MONGODB_URI=process.env.MONGODB_URI;var i=n();i.use(s()),i.use(n.json()),i.use(n.urlencoded({extended:!0})),a.token("body",(function(e){return JSON.stringify(e.body)})),i.use(a(":method :url :status :response-time ms - :res[content-length] :body - :req[content-length]")),i.use("/",u.router),t.listen=function(){i.listen(t.PORT),console.log("Server started at http://localhost:"+t.PORT)},(0,o.connect)()},667:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,o)}i((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};t.__esModule=!0,t.upload=t.avatarStorage=t.bucket=t.connect=void 0;var s=r(738),u=r(185),o=r(607),i=r(940);function c(){var e=u.default.connections[0].db;t.bucket=new u.default.mongo.GridFSBucket(e,{bucketName:"filesBucket"})}r(142).config(),t.connect=function e(){return n(this,void 0,void 0,(function(){return a(this,(function(t){u.default.set("strictQuery",!0),u.default.connection.on("error",console.error).on("disconnected",e).on("connected",c).once("open",o.listen);try{return[2,u.default.connect(o.MONGODB_URI,{})]}catch(e){throw e}return[2]}))}))},t.avatarStorage=new i.GridFsStorage({url:process.env.MONGODB_URI,file:function(e){return new Promise((function(t){t({filename:e.body._id+"avatar",bucketName:"filesBucket"})})).catch((function(e){return console.error(e)}))}}),t.upload=s({fileFilter:function(e,t,r){t.mimetype.includes("jpeg")||t.mimetype.includes("png")||t.mimetype.includes("jpg")?r(null,!0):r(null,!1)}})},553:(e,t,r)=>{t.__esModule=!0,t.schema=void 0;var n=r(185),a=new n.Schema({en_us:{type:String,required:!0},es_es:{type:String,required:!0},ru:{type:String,required:!0},uk:{type:String,required:!0}}),s=new n.Schema({levelNumber:{type:Number,required:!0},game:{type:String,required:!0},winCondition:{type:String,required:!0},name:{type:a,required:!0},description:{paragraph:{type:a,required:!0},rulesList:{type:[a],required:!0},example:{type:a,required:!0}},submitText:{type:a,required:!0},type1Quantity:{type:Number,required:!0},type2Quantity:{type:Number,required:!0},type3Quantity:{type:Number,required:!0}}),u=n.default.model("LevelData",s);t.schema=u.schema,t.default=u},966:(e,t,r)=>{t.__esModule=!0,t.schema=void 0;var n=r(185),a=new n.Schema({username:{type:String,unique:!0,required:!0},email:{type:String,unique:!0,required:!0},password:{type:String,required:!0},isAdmin:{type:Boolean,required:!0}}),s=n.default.model("User",a);t.schema=s.schema,t.default=s},736:(e,t,r)=>{t.__esModule=!0,t.schema=void 0;var n=r(185),a=r(13),s=new n.Schema({username:{type:String,unique:!0,required:!0},levelFlexbox:{type:Number,required:!0,default:1},language:{type:String,required:!0,default:"en_us"},avatarId:{type:a.ObjectId}}),u=n.default.model("UserData",s);t.schema=u.schema,t.default=u},14:(e,t,r)=>{t.__esModule=!0,t.router=void 0;var n=r(507),a=r(860),s=r(667),u=r(198),o=r(105),i=r(776),c=r(874);t.router=a.Router(),t.router.post("/login",n.loginUser),t.router.post("/register",(0,n.checkEmailEligibility)(!1),(0,n.checkUsernameEligibility)(!1),n.registerUser),t.router.post("/register/check-username",(0,n.checkUsernameEligibility)(!0)),t.router.post("/register/check-email",(0,n.checkEmailEligibility)(!0)),t.router.patch("/avatar",(0,n.verifyToken)(!1,!1),s.upload.single("file"),u.processAvatar,(0,n.verifyToken)(!1,!1),u.updateAvatar),t.router.get("/avatar/:username",u.getAvatar),t.router.patch("/avatar/:username",(0,n.verifyToken)(!0,!1),s.upload.single("file"),u.processAvatar,(0,n.verifyToken)(!0,!1),u.updateAvatarByUsername),t.router.patch("/user",(0,n.verifyToken)(!1,!1),o.updateUserData,o.getUserData),t.router.get("/user",(0,n.verifyToken)(!1,!1),o.getUserData),t.router.patch("/user/:username",(0,n.verifyToken)(!0,!1),o.updateUserDataByUsername,o.getUserDataByUsername),t.router.get("/user/:username",(0,n.verifyToken)(!0,!1),o.getUserDataByUsername),t.router.get("/records",(0,n.verifyToken)(!1,!1),i.getUsersRecords),t.router.get("/levels/:game/:level",(0,n.verifyToken)(!1,!1),c.getLevel),t.router.post("/levels",c.addLevel),t.router.get("/check-auth",(0,n.verifyToken)(!1,!0))},432:e=>{e.exports=require("bcryptjs")},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},344:e=>{e.exports=require("jsonwebtoken")},13:e=>{e.exports=require("mongodb")},185:e=>{e.exports=require("mongoose")},470:e=>{e.exports=require("morgan")},738:e=>{e.exports=require("multer")},940:e=>{e.exports=require("multer-gridfs-storage")},441:e=>{e.exports=require("sharp")},781:e=>{e.exports=require("stream")}},t={};!function r(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}(607)})();