(()=>{"use strict";var e={874:function(e,r,t){var n=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var r;e.done?a(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(u,o)}i((n=n.apply(e,r||[])).next())}))},a=this&&this.__generator||function(e,r){var t,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=r.call(e,u)}catch(e){o=[6,e],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};r.__esModule=!0,r.getLevel=r.addLevel=void 0;var s=t(553),u=t(736);r.addLevel=function(e,r){return n(this,void 0,void 0,(function(){var t,n,u;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t=e.body,[4,s.default.create(t)];case 1:return n=a.sent(),r.status(200).json(n),[3,3];case 2:return u=a.sent(),console.error(u),r.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))},r.getLevel=function(e,r){return n(this,void 0,void 0,(function(){var t,n,o,i,c,l,d;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t=e.params.game,n=Number(e.params.level),t&&n?[4,s.default.findOne({game:t,levelNumber:n})]:[2];case 1:return o=a.sent(),[4,u.default.findOne({_id:e.body.userData.user_id})];case 2:return(i=a.sent())?o?(c=o.description.rulesList.map((function(e){return e[i.language]})),l={winCondition:o.winCondition,name:o.name[i.language],description:{paragraph:o.description.paragraph[i.language],rulesList:c,example:o.description.example[i.language]},submitText:o.submitText[i.language],type1Quantity:o.type1Quantity,type2Quantity:o.type2Quantity,type3Quantity:o.type3Quantity},r.status(200).json(l),[3,4]):[2,r.status(404).send("Level ".concat(n,' of the game "').concat(t,'" not found'))]:[2,r.status(401).send("Invalid Token")];case 3:return d=a.sent(),console.error(d),r.status(500).send("Server error"),[3,4];case 4:return[2]}}))}))}},507:function(e,r,t){var n=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var r;e.done?a(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(u,o)}i((n=n.apply(e,r||[])).next())}))},a=this&&this.__generator||function(e,r){var t,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=r.call(e,u)}catch(e){o=[6,e],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};r.__esModule=!0,r.verifyToken=r.checkEmailEligibility=r.checkUsernameEligibility=r.registerUser=r.loginUser=void 0;var s=t(432),u=t(344),o=t(966),i=t(736);r.loginUser=function(e,r){return n(this,void 0,void 0,(function(){var t,n,i,c,l,d,f,p,h;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,7,,8]),"login"in e.body&&"password"in e.body?(t=e.body,n=t.login,i=t.password,[4,o.default.findOne({email:n})]):[2,r.status(400).send('Invalid input: "password" and "login" are required')];case 1:return(l=a.sent())?[3,3]:[4,o.default.findOne({username:n})];case 2:l=a.sent(),a.label=3;case 3:return(c=l)?(d=c.password,[4,s.compare(i,d)]):[3,5];case 4:return a.sent()?(f=u.sign({user_id:c._id,isAdmin:c.isAdmin},process.env.TOKEN_KEY,{expiresIn:process.env.TOKEN_LIFETIME}),p={username:c.username,email:c.email,token:f},r.status(200).json(p),[3,6]):(r.status(404).send('User with this "password" and "login" was not found'),[2]);case 5:return r.status(404).send('User with this "password" and "login" was not found'),[2];case 6:return[3,8];case 7:return h=a.sent(),console.error(h),r.status(500).send("Server error"),[3,8];case 8:return[2]}}))}))};var c=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;r.registerUser=function(e,r){return n(this,void 0,void 0,(function(){var t,n,l,d,f,p,h,v,y,m,g;return a(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,4,,5]),t=e.body,n=t.email,l=t.password,d=t.username,f=t.adminPassword,p=!1,!(n&&l&&d))return[2,r.status(400).send('Invalid input: "email", "password" and "username" are required')];if(!c.test(n))return[2,r.status(400).send("Invalid email")];if(l.length<6)return[2,r.status(400).send("Password must be at least 6 characters long")];if(f){if(f!==process.env.ADMIN_PASSWORD)return[2,r.status(401).send("Invalid admin password")];p=!0}return[4,s.hash(l,10)];case 1:return h=a.sent(),[4,o.default.create({email:n.toLowerCase(),username:d,password:h,isAdmin:p})];case 2:return v=a.sent(),[4,i.default.create({username:d,_id:v._id})];case 3:return a.sent(),y=u.sign({user_id:v._id,isAdmin:p},process.env.TOKEN_KEY,{expiresIn:process.env.TOKEN_LIFETIME}),m={username:d,email:n,token:y},r.status(201).json(m),[3,5];case 4:return g=a.sent(),console.error(g),r.status(500).send("Server error"),[3,5];case 5:return[2]}}))}))},r.checkUsernameEligibility=function(e){var r=this;return function(t,s,u){return n(r,void 0,void 0,(function(){var r,n;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),(r=t.body.username)?[3,1]:[2,s.status(400).send('Invalid input: "username" is required')];case 1:return[4,o.default.findOne({username:r})];case 2:if(a.sent())return[2,s.status(422).send("Username is already taken")];a.label=3;case 3:return e?(s.end(),[3,5]):[2,u()];case 4:return n=a.sent(),console.error(n),s.status(500).send("Server error"),[3,5];case 5:return[2]}}))}))}},r.checkEmailEligibility=function(e){var r=this;return function(t,s,u){return n(r,void 0,void 0,(function(){var r,n;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),(r=t.body.email)?[3,1]:[2,s.status(400).send('Invalid input: "email" is required')];case 1:return[4,o.default.findOne({email:r})];case 2:if(a.sent())return[2,s.status(409).send("A user with this email address already exists")];a.label=3;case 3:return e?(s.end(),[3,5]):[2,u()];case 4:return n=a.sent(),console.error(n),s.status(500).send("Server error"),[3,5];case 5:return[2]}}))}))}},r.verifyToken=function(e,r){var t=this;return function(s,o,i){return n(t,void 0,void 0,(function(){var t,n;return a(this,(function(a){if(!(t=s.body.token||s.query.token||s.headers["x-access-token"]))return[2,o.status(403).send("A token is required for authentication")];try{if(void 0===(n=u.verify(t,process.env.TOKEN_KEY)).user_id||void 0===n.isAdmin)return[2,o.status(401).send("Invalid Token")];if(e&&!n.isAdmin)return[2,o.status(401).send("You don't have rights to do that")];s.body.userData=n}catch(e){return[2,o.status(401).send("Invalid Token")]}return r?[2,o.status(200).end()]:[2,i()]}))}))}}},198:function(e,r,t){var n=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var r;e.done?a(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(u,o)}i((n=n.apply(e,r||[])).next())}))},a=this&&this.__generator||function(e,r){var t,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=r.call(e,u)}catch(e){o=[6,e],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};r.__esModule=!0,r.processAvatar=r.getAvatar=r.updateAvatarByUsername=r.updateAvatar=void 0;var s=t(441),u=t(736),o=t(781),i=t(667),c=t(13);r.updateAvatar=function(e,r){return n(this,void 0,void 0,(function(){var t,n,s;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t=e.body.avatarId,n=e.body.userData.user_id,[4,u.default.findOneAndUpdate({_id:n},{avatarId:t},{new:!0})];case 1:return a.sent(),r.status(200).end(),[3,3];case 2:return s=a.sent(),console.error(s),r.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))},r.updateAvatarByUsername=function(e,r){return n(this,void 0,void 0,(function(){var t,n,s;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),t=e.body.avatarId,(n=e.params.username)?[4,u.default.findOneAndUpdate({username:n},{avatarId:t},{new:!0})]:[3,2];case 1:return a.sent(),[3,3];case 2:return[2,r.status(400).send('Invalid input: "username" is required')];case 3:return r.status(200).end(),[3,5];case 4:return s=a.sent(),console.error(s),r.status(500).send("Server error"),[3,5];case 5:return[2]}}))}))};var l=new c.ObjectId(process.env.DEFAULT_AVATARID);r.getAvatar=function(e,r){return n(this,void 0,void 0,(function(){var t,n,s,o,c;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),(t=e.params.username)?[4,u.default.findOne({username:t})]:[2,r.status(400).send('Invalid input: "username" is required')];case 1:return(n=a.sent())?n.avatarId?(s=void 0,[4,i.bucket.find({_id:n.avatarId}).toArray()]):(r.setHeader("content-type","image/png"),i.bucket.openDownloadStream(l).pipe(r),[2]):[2,r.status(404).send('User with this "username" not found')];case 2:return o=a.sent(),s=o&&0!==o.length?n.avatarId:l,i.bucket.openDownloadStream(s).pipe(r),[3,4];case 3:return c=a.sent(),console.error(c),r.status(500).send("Server error"),[3,4];case 4:return[2]}}))}))},r.processAvatar=function(e,r,t){return n(this,void 0,void 0,(function(){var n,u;return a(this,(function(a){try{n=e.file,u=n.buffer,s(u).resize(192,192,{fit:"contain",background:"#fff"}).flatten({background:"#fff"}).jpeg({quality:50}).toBuffer((function(r,a){var s=o.Readable.from(a);i.avatarStorage.fromStream(s,e,n).then((function(r){e.body.avatarId=r.id,t()}))}))}catch(e){console.error(e),r.status(500).send("Server error")}return[2]}))}))}},105:function(e,r,t){var n=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var r;e.done?a(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(u,o)}i((n=n.apply(e,r||[])).next())}))},a=this&&this.__generator||function(e,r){var t,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=r.call(e,u)}catch(e){o=[6,e],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};r.__esModule=!0,r.getUserDataByUsername=r.getUserData=r.updateUserDataByUsername=r.updateUserData=void 0;var s=t(736);r.updateUserData=function(e,r,t){return n(this,void 0,void 0,(function(){var n,u,o,i,c,l,d;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=e.body,u=n.language,o=n.records,u||o?(i=e.body.userData.user_id,[4,s.default.findOneAndUpdate({_id:i},{language:u,records:o},{new:!0})]):[2,t()];case 1:return(c=a.sent())?(l={language:c.language,records:c.records},r.status(200).json(l),[3,3]):[2,r.status(401).send("Invalid Token")];case 2:return d=a.sent(),console.error(d),r.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))},r.updateUserDataByUsername=function(e,r,t){return n(this,void 0,void 0,(function(){var n,u,o,i,c,l,d;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=e.body,u=n.language,o=n.records,u||o?(i=e.params.username)?[4,s.default.findOneAndUpdate({username:i},{language:u,records:o},{new:!0})]:[2,r.status(400).send('Invalid input: "username" is required')]:[2,t()];case 1:return c=a.sent(),l={language:c.language,records:c.records},r.status(200).json(l),[3,3];case 2:return d=a.sent(),console.error(d),r.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))},r.getUserData=function(e,r){return n(this,void 0,void 0,(function(){var t,n,u,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),t=e.body.userData.user_id,[4,s.default.findOne({_id:t})];case 1:return(n=a.sent())?(u={language:n.language,records:n.records},r.status(200).json(u),[3,3]):[2,r.status(401).send("Invalid Token")];case 2:return o=a.sent(),console.error(o),r.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))},r.getUserDataByUsername=function(e,r){return n(this,void 0,void 0,(function(){var t,n,u,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),(t=e.params.username)?e.body.userData.isAdmin?[4,s.default.findOne({username:t})]:[2,r.status(401).send("You don't have rights to do that")]:[2,r.status(400).send('Invalid input: "username" is required')];case 1:return(n=a.sent())?(u={language:n.language,records:n.records},r.status(200).json(u),[3,3]):[2,r.status(404).send('User with this "nickname" not found')];case 2:return o=a.sent(),console.error(o),r.status(500).send("Server error"),[3,3];case 3:return[2]}}))}))}},776:function(e,r,t){var n=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var r;e.done?a(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(u,o)}i((n=n.apply(e,r||[])).next())}))},a=this&&this.__generator||function(e,r){var t,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=r.call(e,u)}catch(e){o=[6,e],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};r.__esModule=!0,r.getUsersRecords=void 0;var s=t(736);r.getUsersRecords=function(e,r){return n(this,void 0,void 0,(function(){var t,n,u,o,i,c,l,d,f;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t={page:Number(e.query.page),limit:Number(e.query.limit),order:e.query.order,sort:e.query.sort.toString()},n=s.default.aggregate().project({_id:0,username:1,records:1}),!Number.isNaN(t.limit)&&t.limit>0&&(!Number.isNaN(t.page)&&t.page>0&&n.skip(t.limit*(t.page-1)),n.limit(t.limit)),"records.flexbox"===t.sort?(n.addFields({length:{$size:"$".concat(t.sort)}}),n.sort({length:t.order})):((u={})[t.sort]=t.order,n.sort(u)),[4,n.exec()];case 1:return o=a.sent(),c=(i=r).setHeader,l=["X-Total-Count"],d="".concat,[4,s.default.find().estimatedDocumentCount().exec()];case 2:return c.apply(i,l.concat([d.apply("",[a.sent()])])),r.status(200).json(o),[3,4];case 3:return f=a.sent(),console.error(f),r.status(500).send("Server error"),[3,4];case 4:return[2]}}))}))}},607:(e,r,t)=>{r.__esModule=!0,r.listen=r.MONGODB_URI=r.PORT=void 0;var n=t(860);t(142).config();var a=t(470),s=t(582),u=t(14),o=t(667);r.PORT=process.env.PORT,r.MONGODB_URI=process.env.MONGODB_URI;var i=n();i.use(s({credentials:!0,origin:!0})),i.use(n.json()),i.use(n.urlencoded({extended:!0})),a.token("body",(function(e){return JSON.stringify(e.body)})),i.use(a(":method :url :status :response-time ms - :res[content-length] :body - :req[content-length]")),i.use("/",u.router),r.listen=function(){i.listen(r.PORT),console.log("Server started at http://localhost:"+r.PORT)},(0,o.connect)()},667:function(e,r,t){var n=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))((function(a,s){function u(e){try{i(n.next(e))}catch(e){s(e)}}function o(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var r;e.done?a(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(u,o)}i((n=n.apply(e,r||[])).next())}))},a=this&&this.__generator||function(e,r){var t,n,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(i){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(t=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((a=(a=u.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=r.call(e,u)}catch(e){o=[6,e],n=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};r.__esModule=!0,r.upload=r.avatarStorage=r.bucket=r.connect=void 0;var s=t(738),u=t(185),o=t(607),i=t(940);function c(){var e=u.default.connections[0].db;r.bucket=new u.default.mongo.GridFSBucket(e,{bucketName:"filesBucket"})}t(142).config(),r.connect=function e(){return n(this,void 0,void 0,(function(){return a(this,(function(r){u.default.set("strictQuery",!0),u.default.connection.on("error",console.error).on("disconnected",e).on("connected",c).once("open",o.listen);try{return[2,u.default.connect(o.MONGODB_URI,{})]}catch(e){throw e}return[2]}))}))},r.avatarStorage=new i.GridFsStorage({url:process.env.MONGODB_URI,file:function(e){return new Promise((function(r){r({filename:e.body._id+"avatar",bucketName:"filesBucket"})})).catch((function(e){return console.error(e)}))}}),r.upload=s({fileFilter:function(e,r,t){r.mimetype.includes("jpeg")||r.mimetype.includes("png")||r.mimetype.includes("jpg")?t(null,!0):t(null,!1)}})},553:(e,r,t)=>{r.__esModule=!0,r.schema=void 0;var n=t(185),a=new n.Schema({en_us:{type:String,required:!0},es_es:{type:String,required:!0},ru:{type:String,required:!0},uk:{type:String,required:!0}}),s=new n.Schema({levelNumber:{type:Number,required:!0},game:{type:String,required:!0},winCondition:{type:String,required:!0},name:{type:a,required:!0},description:{paragraph:{type:a,required:!0},rulesList:{type:[a],required:!0},example:{type:a,required:!0}},submitText:{type:a,required:!0},type1Quantity:{type:Number,required:!0},type2Quantity:{type:Number,required:!0},type3Quantity:{type:Number,required:!0}}),u=n.default.model("LevelData",s);r.schema=u.schema,r.default=u},966:(e,r,t)=>{r.__esModule=!0,r.schema=void 0;var n=t(185),a=new n.Schema({username:{type:String,unique:!0,required:!0,trim:!0},email:{type:String,unique:!0,required:!0,trim:!0},password:{type:String,required:!0,trim:!0},isAdmin:{type:Boolean,required:!0}}),s=n.default.model("User",a);r.schema=s.schema,r.default=s},736:(e,r,t)=>{r.__esModule=!0,r.schema=void 0;var n=t(185),a=t(13),s=new n.Schema({flexbox:{type:[Number],default:[]}}),u=new n.Schema({username:{type:String,unique:!0,required:!0},language:{type:String,required:!0,default:"en_us"},avatarId:{type:a.ObjectId},records:{type:s,required:!0,default:{flexbox:[]}}}),o=n.default.model("UserData",u);r.schema=o.schema,r.default=o},14:(e,r,t)=>{r.__esModule=!0,r.router=void 0;var n=t(507),a=t(860),s=t(667),u=t(198),o=t(105),i=t(776),c=t(874);r.router=a.Router(),r.router.post("/login",n.loginUser),r.router.post("/register",(0,n.checkEmailEligibility)(!1),(0,n.checkUsernameEligibility)(!1),n.registerUser),r.router.post("/register/check-username",(0,n.checkUsernameEligibility)(!0)),r.router.post("/register/check-email",(0,n.checkEmailEligibility)(!0)),r.router.patch("/avatar",(0,n.verifyToken)(!1,!1),s.upload.single("file"),u.processAvatar,(0,n.verifyToken)(!1,!1),u.updateAvatar),r.router.get("/avatar/:username",u.getAvatar),r.router.patch("/avatar/:username",(0,n.verifyToken)(!0,!1),s.upload.single("file"),u.processAvatar,(0,n.verifyToken)(!0,!1),u.updateAvatarByUsername),r.router.patch("/user",(0,n.verifyToken)(!1,!1),o.updateUserData,o.getUserData),r.router.get("/user",(0,n.verifyToken)(!1,!1),o.getUserData),r.router.patch("/user/:username",(0,n.verifyToken)(!0,!1),o.updateUserDataByUsername,o.getUserDataByUsername),r.router.get("/user/:username",(0,n.verifyToken)(!0,!1),o.getUserDataByUsername),r.router.get("/records",(0,n.verifyToken)(!1,!1),i.getUsersRecords),r.router.get("/levels/:game/:level",(0,n.verifyToken)(!1,!1),c.getLevel),r.router.post("/levels",c.addLevel),r.router.get("/check-auth",(0,n.verifyToken)(!1,!0))},432:e=>{e.exports=require("bcryptjs")},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},344:e=>{e.exports=require("jsonwebtoken")},13:e=>{e.exports=require("mongodb")},185:e=>{e.exports=require("mongoose")},470:e=>{e.exports=require("morgan")},738:e=>{e.exports=require("multer")},940:e=>{e.exports=require("multer-gridfs-storage")},441:e=>{e.exports=require("sharp")},781:e=>{e.exports=require("stream")}},r={};!function t(n){var a=r[n];if(void 0!==a)return a.exports;var s=r[n]={exports:{}};return e[n].call(s.exports,s,s.exports,t),s.exports}(607)})();